这里的宏任务、微任务仅仅说浏览器和`nodejs`的`v8`相同的地方，`nodejs`独有的一些宏任务函数暂且不提
且后面提到的`事件循环Event Loop`都以浏览器为准
`nodejs`要和系统打交道，不会涉及到渲染、鼠标移动这些界面上的操作，而浏览器的环境正是要和这些东西打交道，所以这两者不太相同



#### 浏览器的宏任务、微任务

首先，宏任务、微任务在浏览器里面都是些什么任务

**宏任务**（macro task）：定时器，计时器，ui交互，I/O，一些脚本script。这个不是同步任务，而是一些不应该影响主线程的，能独立执行完成的任务

**微任务**（micro task）：Promise、网络请求（本质也是Promise）、`MutationObserve`API

**同步任务**：就是常规的js代码，按照正常流程最先执行的代码



这些任务都是为了不影响主线程的执行，不阻塞主线程的代码而引入的

#### 浏览器事件循环 Event Loop

有了这个机制，上面的宏任务和微任务才有了用武之地

执行一些常规的代码（同步代码） → 执行所有微任务 → 渲染 → 宏任务 → 执行一些常规的代码..... → ....

![https://static.xuyanshe.club/img/202307261039340.png](宏任务+微任务+024c062c-3e9d-4ebe-a304-5632bc3f1741/202307261039340.png)

这里有一些细节

宏任务的执行是从一个宏任务队列（macro task queue）中取出的，执行一个宏任务队列中的一个最早的任务，就要完成一遍上面的事件循环机制

微任务则会全部执行完毕，也就是取出当前微任务队列中的所有微任务，并执行完毕





