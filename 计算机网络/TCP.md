# TCP

## 概念
传输控制协议(Transmission Control Protocol)，简称: TCP。看名字是一个协议，所以在IP层至上，应用层之下（这里指ISO的七层或者TCP/IP网络协议栈）

可靠的传输协议，传输的数据会按照顺序发送给接收方，且发错的数据会重新传送

## TCP层（仅针对TCP协议就先叫这个名字）

介于应用层和IP层（网络层）之间  
+ 发送数据时  
  
  从上层应用层开始，由用户数据和`Appl`首部组成，交给传输层（TCP层）  
  TCP层组装自己的`TCP`首部，之后再次向下传输给网络层（IP层）现在称之为分段（Segament）  
  IP层再次组装，形成IP报文，再给链路层形成以太网帧就可以发送给目标了

+ 数据接受时  

  是上面发送过程的反向，反过来就可以

## 传输层怎么封装的

### Segament结构

TCP头部 + 应用层数据

### TCP首部结构

20字节长度（不包含`Options`部分），其中包含5个部分（每一个部分是4字节），每一个部分的组成都不相同，但大小范围都在4字节（16位）- 8字节（32位）

![tcp header](./TCP/tcpheader.png)

+ 源端口、目的端口  

  因为TCP段解析完成后，应用层的数据就直接给应用层了，所以也是对应的本机的进程（进程通过端口号来区分）

+ TCP序列号（Sequence Number）  
  
  序列号决定了TCP报文的顺序，具体点就是发送第一个TCP报文到最后一个TCP报文的序号，有了序号可以去重TCP报文、丢失的包可以重发、可以给应用层一个顺序正确的流（stream）

+ 